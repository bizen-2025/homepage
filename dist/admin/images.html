<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>이미지 관리 - BIZEN</title>
  <link rel="stylesheet" href="../css/dashboard.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
</head>
<body>
  <div class="dashboard-container">
    <!-- 사이드바 -->
    <aside class="sidebar"></aside>

    <!-- 메인 콘텐츠 -->
    <main class="main-content">
      <!-- 헤더 -->
      <header class="dashboard-header"></header>

      <!-- 이미지 관리 -->
      <section class="images-section">
        <!-- 업로드 영역 -->
        <div class="upload-zone" id="uploadZone" onclick="document.getElementById('fileInput').click()">
          <input type="file" id="fileInput" multiple accept="image/*" style="display:none" onchange="handleFileSelect(event)">
          <div class="upload-zone-icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="17 8 12 3 7 8"/>
              <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
          </div>
          <p class="upload-zone-text">이미지를 드래그하거나 클릭하여 업로드</p>
          <p class="upload-zone-hint">JPG, PNG, GIF 지원 · 최대 5MB · 자동 WebP 변환</p>
        </div>

        <!-- 필터 & 검색 -->
        <div class="filter-row" style="margin-bottom:20px">
          <div class="filter-group">
            <select class="filter-select" id="imageFilter">
              <option value="all">전체 이미지</option>
              <option value="hero">히어로</option>
              <option value="service">서비스</option>
              <option value="team">팀</option>
              <option value="etc">기타</option>
            </select>
            <select class="filter-select" id="formatFilter">
              <option value="all">전체 포맷</option>
              <option value="webp">WebP</option>
              <option value="jpg">JPG</option>
              <option value="png">PNG</option>
            </select>
          </div>
          <div class="filter-summary" style="margin:0; padding:0; border:0">
            <span>총 <strong id="imageCount">6</strong>개</span>
          </div>
        </div>

        <!-- 이미지 그리드 -->
        <div class="image-grid" id="imageGrid">
          <!-- 이미지 카드 1 -->
          <div class="image-card">
            <div class="image-preview">
              <img src="../기업심사관_전예진.jpg" alt="기업심사관 전예진">
              <div class="image-overlay">
                <button onclick="viewImage(this)" title="확대보기">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                    <line x1="11" y1="8" x2="11" y2="14"/>
                    <line x1="8" y1="11" x2="14" y2="11"/>
                  </svg>
                </button>
                <button onclick="convertToWebp(this)" title="WebP 변환">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="23 4 23 10 17 10"/>
                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                  </svg>
                </button>
                <button class="btn-delete" onclick="deleteImage(this)" title="삭제">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                  </svg>
                </button>
              </div>
            </div>
            <div class="image-info">
              <p class="image-name">기업심사관_전예진.jpg</p>
              <div class="image-meta">
                <span>1.2 MB</span>
                <span>JPG</span>
              </div>
              <input type="text" class="image-alt-input" placeholder="alt 텍스트 입력..." value="기업심사관 전예진" onchange="saveAlt(this)">
            </div>
          </div>

          <!-- 이미지 카드 2 -->
          <div class="image-card">
            <div class="image-preview">
              <img src="../기업심사관_김우영.jpg" alt="기업심사관 김우영">
              <div class="image-overlay">
                <button onclick="viewImage(this)" title="확대보기">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                    <line x1="11" y1="8" x2="11" y2="14"/>
                    <line x1="8" y1="11" x2="14" y2="11"/>
                  </svg>
                </button>
                <button onclick="convertToWebp(this)" title="WebP 변환">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="23 4 23 10 17 10"/>
                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                  </svg>
                </button>
                <button class="btn-delete" onclick="deleteImage(this)" title="삭제">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                  </svg>
                </button>
              </div>
            </div>
            <div class="image-info">
              <p class="image-name">기업심사관_김우영.jpg</p>
              <div class="image-meta">
                <span>980 KB</span>
                <span>JPG</span>
              </div>
              <input type="text" class="image-alt-input" placeholder="alt 텍스트 입력..." value="기업심사관 김우영" onchange="saveAlt(this)">
            </div>
          </div>

          <!-- 이미지 카드 3 (WebP) -->
          <div class="image-card">
            <div class="image-preview">
              <img src="../BIZEN_01_02.png" alt="BIZEN 로고">
              <div class="image-overlay">
                <button onclick="viewImage(this)" title="확대보기">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                    <line x1="11" y1="8" x2="11" y2="14"/>
                    <line x1="8" y1="11" x2="14" y2="11"/>
                  </svg>
                </button>
                <button onclick="convertToWebp(this)" title="WebP 변환">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="23 4 23 10 17 10"/>
                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                  </svg>
                </button>
                <button class="btn-delete" onclick="deleteImage(this)" title="삭제">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                  </svg>
                </button>
              </div>
            </div>
            <div class="image-info">
              <p class="image-name">BIZEN_01_02.png</p>
              <div class="image-meta">
                <span>156 KB</span>
                <span>PNG</span>
              </div>
              <input type="text" class="image-alt-input" placeholder="alt 텍스트 입력..." value="BIZEN 로고" onchange="saveAlt(this)">
            </div>
          </div>

          <!-- 샘플 WebP 이미지 -->
          <div class="image-card">
            <div class="image-preview" style="background:#E6F2FF; display:flex; align-items:center; justify-content:center;">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#0066CC" stroke-width="1.5">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <circle cx="8.5" cy="8.5" r="1.5"/>
                <polyline points="21 15 16 10 5 21"/>
              </svg>
              <div class="image-overlay">
                <button onclick="viewImage(this)" title="확대보기">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                    <line x1="11" y1="8" x2="11" y2="14"/>
                    <line x1="8" y1="11" x2="14" y2="11"/>
                  </svg>
                </button>
                <button class="btn-delete" onclick="deleteImage(this)" title="삭제">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                  </svg>
                </button>
              </div>
            </div>
            <div class="image-info">
              <p class="image-name">hero-main.webp</p>
              <div class="image-meta">
                <span>89 KB</span>
                <span class="webp-badge">WebP</span>
              </div>
              <input type="text" class="image-alt-input" placeholder="alt 텍스트 입력..." value="정책자금 컨설팅 메인 이미지" onchange="saveAlt(this)">
            </div>
          </div>
        </div>
      </section>

      <!-- WebP 변환 안내 -->
      <section class="info-section">
        <div class="alert alert-info">
          <div class="alert-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <line x1="12" y1="16" x2="12" y2="12"/>
              <line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
          </div>
          <div class="alert-content">
            <h4 class="alert-title">WebP 변환 안내</h4>
            <p>WebP 포맷은 JPG/PNG 대비 <strong>30~50% 용량 절감</strong>되어 사이트 로딩 속도가 개선됩니다. 업로드 시 자동으로 WebP 버전이 생성됩니다.</p>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- 이미지 뷰어 모달 -->
  <div class="modal-overlay" id="imageViewerModal" onclick="closeImageViewer()">
    <div class="modal" style="max-width:90vw; max-height:90vh; background:transparent; box-shadow:none;" onclick="event.stopPropagation()">
      <img id="viewerImage" src="" alt="" style="max-width:100%; max-height:85vh; border-radius:12px;">
      <button class="modal-close" onclick="closeImageViewer()" style="position:absolute; top:-40px; right:0; background:white; border-radius:50%;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
  </div>

  <script src="../js/components.js"></script>
  <script>
    // 페이지 로드 시 컴포넌트 초기화
    document.addEventListener('DOMContentLoaded', function() {
      loadSidebar('images');
      loadDashboardHeader('이미지 관리', 'WebP 변환 및 alt 텍스트 관리');
      initDragDrop();
    });

    // 드래그 앤 드롭 초기화
    function initDragDrop() {
      const uploadZone = document.getElementById('uploadZone');

      uploadZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.classList.add('dragover');
      });

      uploadZone.addEventListener('dragleave', () => {
        uploadZone.classList.remove('dragover');
      });

      uploadZone.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.classList.remove('dragover');
        const files = e.dataTransfer.files;
        handleFiles(files);
      });
    }

    // 파일 선택 처리
    function handleFileSelect(event) {
      const files = event.target.files;
      handleFiles(files);
    }

    // 파일 처리
    function handleFiles(files) {
      for (let file of files) {
        if (!file.type.startsWith('image/')) {
          alert('이미지 파일만 업로드 가능합니다.');
          continue;
        }
        if (file.size > 5 * 1024 * 1024) {
          alert('파일 크기는 5MB 이하만 가능합니다.');
          continue;
        }
        // TODO: 실제 업로드 처리
        console.log('업로드:', file.name);
        alert(`${file.name} 업로드 완료 (데모)`);
      }
    }

    // 이미지 확대보기
    function viewImage(btn) {
      const img = btn.closest('.image-preview').querySelector('img');
      if (img) {
        document.getElementById('viewerImage').src = img.src;
        document.getElementById('imageViewerModal').classList.add('open');
      }
    }

    function closeImageViewer() {
      document.getElementById('imageViewerModal').classList.remove('open');
    }

    // WebP 변환
    function convertToWebp(btn) {
      const card = btn.closest('.image-card');
      const name = card.querySelector('.image-name').textContent;
      alert(`${name} → WebP 변환 중... (데모)`);
      // TODO: 실제 WebP 변환 API 호출
    }

    // 이미지 삭제
    function deleteImage(btn) {
      if (confirm('정말 삭제하시겠습니까?')) {
        const card = btn.closest('.image-card');
        card.remove();
        updateImageCount();
      }
    }

    // alt 텍스트 저장
    function saveAlt(input) {
      console.log('alt 저장:', input.value);
      // TODO: 실제 저장 API 호출
    }

    // 이미지 개수 업데이트
    function updateImageCount() {
      const count = document.querySelectorAll('.image-card').length;
      document.getElementById('imageCount').textContent = count;
    }

    // ESC 키로 모달 닫기
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeImageViewer();
      }
    });
  </script>
</body>
</html>
